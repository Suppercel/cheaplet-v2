<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Cheaplet</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: #f8f9fa; color: #333; line-height: 1.6; display: flex; flex-direction: column; min-height: 100vh; }
        .container { width: 100%; max-width: 1200px; margin: 0 auto; padding: 0 15px; }

        /* Reuse Header Styles for consistency */
        header { background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); color: white; padding: 15px 0; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 24px; font-weight: bold; }
        .logo a { color: inherit; text-decoration: none; display: flex; align-items: center; }
        .logo span { color: #FFD700; }

        /* Auth Form Styles */
        .auth-container { flex-grow: 1; display: flex; align-items: center; justify-content: center; padding: 40px 20px; }
        .firebase-form-section { background-color: white; padding: 40px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 450px; text-align: center; }
        .firebase-form-section h2 { margin-bottom: 10px; color: #2E7D32; font-size: 1.8rem; }
        .firebase-form-section p { color: #666; margin-bottom: 25px; }
        
        input { padding: 12px; border: 2px solid #ddd; border-radius: 6px; width: 100%; margin-bottom: 15px; transition: border-color 0.3s; font-size: 1rem; }
        input:focus { outline: none; border-color: #4CAF50; }
        
        .btn { background: linear-gradient(135deg, #FFD700 0%, #FFC400 100%); color: #333; border: none; padding: 12px 20px; border-radius: 6px; font-weight: bold; cursor: pointer; transition: all 0.3s; width: 100%; font-size: 1rem; margin-top: 10px; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        
        .btn-secondary { background: white; border: 2px solid #ddd; color: #555; margin-top: 10px; }
        .btn-secondary:hover { background: #f8f9fa; border-color: #ccc; }

        .toggle-link { margin-top: 20px; display: block; color: #4CAF50; text-decoration: none; font-weight: 500; cursor: pointer; }
        .toggle-link:hover { text-decoration: underline; }

        #auth-error { color: #d32f2f; margin-top: 15px; font-size: 0.9rem; min-height: 20px; }
        
        footer { background: #333; color: white; padding: 20px 0; text-align: center; font-size: 0.9rem; margin-top: auto; }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">
                <a href="index.html">Cheap<span>let</span></a>
            </div>
            <a href="index.html" style="color: white; text-decoration: none; font-weight: 500;"><i class="fas fa-arrow-left"></i> Back to Home</a>
        </div>
    </header>

    <div class="auth-container">
        <section id="auth-forms" class="firebase-form-section">
            <h2 id="form-title">Log In</h2>
            <p id="form-subtitle">Welcome back! Please enter your details.</p>
            
            <div id="register-name-fields" style="display: none;">
                <input type="text" id="firstName" placeholder="First Name">
                <input type="text" id="lastName" placeholder="Last Name">
            </div>
            
            <input type="email" id="email" placeholder="Email Address" required>
            <input type="password" id="password" placeholder="Password" required>
            <p id="password-feedback" style="display: none; font-size: 0.8rem; text-align: left; color: #666; margin-bottom: 10px;">Password must be at least 6 characters.</p>

            <button class="btn" id="submitBtn">Log In</button>
            <p id="auth-error"></p>
            
            <a id="toggleAuthMode" class="toggle-link">New to Cheaplet? Create an account</a>
        </section>
    </div>

    <footer>
        <div class="container">
            Â© 2025 Cheaplet. All rights reserved.
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, updateProfile, sendEmailVerification, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-firestore.js";

        // -------------------------------------------------------------
        // PASTE YOUR FIREBASE KEYS HERE TOO!
        // -------------------------------------------------------------
       const firebaseConfig = {
apiKey: "AIzaSyC03fbsmA7O8Puub_rjIYaixp5lbsjCBm4",
authDomain: "cheaplet-v2.firebaseapp.com",
projectId: "cheaplet-v2",
storageBucket: "cheaplet-v2.firebasestorage.app",
messagingSenderId: "910761481670",
appId: "1:910761481670:web:44226b04d27b3f3ed78ec7"
};
        // -------------------------------------------------------------

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const formTitle = document.getElementById('form-title');
        const formSubtitle = document.getElementById('form-subtitle');
        const registerNameFields = document.getElementById('register-name-fields');
        const firstNameInput = document.getElementById('firstName');
        const lastNameInput = document.getElementById('lastName');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const passwordFeedback = document.getElementById('password-feedback');
        const submitBtn = document.getElementById('submitBtn');
        const authError = document.getElementById('auth-error');
        const toggleAuthMode = document.getElementById('toggleAuthMode');

        let isLoginMode = true;

        // If user is already logged in, kick them back to home
        onAuthStateChanged(auth, user => {
            if (user && user.emailVerified) {
                window.location.href = 'index.html';
            }
        });

        function updateUI() {
            if (isLoginMode) {
                formTitle.textContent = 'Log In';
                formSubtitle.textContent = 'Welcome back! Please enter your details.';
                registerNameFields.style.display = 'none';
                passwordFeedback.style.display = 'none';
                submitBtn.textContent = 'Log In';
                toggleAuthMode.textContent = 'New to Cheaplet? Create an account';
            } else {
                formTitle.textContent = 'Create Account';
                formSubtitle.textContent = 'Join Cheaplet to start buying and selling.';
                registerNameFields.style.display = 'block';
                passwordFeedback.style.display = 'block';
                submitBtn.textContent = 'Sign Up';
                toggleAuthMode.textContent = 'Already have an account? Log In';
            }
            authError.textContent = '';
        }

        toggleAuthMode.addEventListener('click', () => {
            isLoginMode = !isLoginMode;
            updateUI();
        });

        submitBtn.addEventListener('click', async () => {
            const email = emailInput.value;
            const password = passwordInput.value;
            authError.textContent = '';

            if (isLoginMode) {
                // LOGIN LOGIC
                try {
                    const userCredential = await signInWithEmailAndPassword(auth, email, password);
                    if (!userCredential.user.emailVerified) {
                        authError.textContent = 'Please verify your email before logging in.';
                        await auth.signOut();
                    } else {
                        // Success! Redirect.
                        window.location.href = 'index.html';
                    }
                } catch (error) {
                    authError.textContent = "Invalid email or password.";
                    console.error(error);
                }
            } else {
                // REGISTER LOGIC
                const firstName = firstNameInput.value.trim();
                const lastName = lastNameInput.value.trim();

                if (!firstName || !lastName) {
                    authError.textContent = "Please enter your first and last name.";
                    return;
                }
                if (password.length < 6) {
                    authError.textContent = "Password must be at least 6 characters.";
                    return;
                }

                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    const displayName = `${firstName} ${lastName}`;
                    
                    // Update Auth Profile
                    await updateProfile(userCredential.user, { displayName: displayName });
                    
                    // Create User Doc in Firestore
                    await setDoc(doc(db, "users", userCredential.user.uid), {
                        uid: userCredential.user.uid,
                        displayName: displayName,
                        email: email
                    });

                    // Send Verification
                    await sendEmailVerification(userCredential.user);
                    await auth.signOut();

                    alert("Account created! Please check your email to verify your account, then log in.");
                    isLoginMode = true;
                    updateUI();
                } catch (error) {
                    authError.textContent = error.message;
                }
            }
        });
    </script>
</body>
</html>
